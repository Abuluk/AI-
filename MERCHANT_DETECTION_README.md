# 商贩检测系统

## 功能概述

商贩检测系统是一个基于AI的智能识别系统，用于自动检测平台上的潜在商贩用户。系统通过分析用户行为模式，使用科大讯飞星火大模型进行智能判断，并自动将识别出的商贩设为待认证状态。

## 核心功能

### 1. 商品监控
- 监控每个分类排序前N个商品
- 监控首页排序前N个商品
- 实时统计用户在售商品数量

### 2. AI智能分析
- 使用科大讯飞星火大模型分析用户行为
- 分析用户商品发布频率、分类分布、价格范围等
- 智能判断用户是否为商贩

### 3. 自动管理
- 自动将识别出的商贩设为待认证状态
- 支持手动检测和配置管理
- 提供详细的检测统计信息

## 系统架构

### 后端组件

1. **MerchantDetectionSystem** (`core/merchant_detection.py`)
   - 核心检测逻辑
   - 用户行为分析
   - AI判断接口

2. **TaskScheduler** (`core/scheduler.py`)
   - 定时任务调度
   - 自动检测执行

3. **配置管理** (`crud/crud_merchant_detection.py`)
   - 检测参数配置
   - 数据库存储

4. **API接口** (`api/endpoints/merchant_detection.py`)
   - 管理员配置接口
   - 手动检测接口
   - 统计信息接口

### 前端组件

1. **商家管理页面** (`frontend/src/views/Admin.vue`)
   - 检测配置界面
   - 手动检测功能
   - 统计信息展示

2. **API服务** (`frontend/src/services/api.js`)
   - 检测相关API调用

## 配置参数

| 参数名 | 默认值 | 说明 |
|--------|--------|------|
| monitor_top_n | 50 | 监控每个分类和首页排序前N个商品 |
| threshold_items | 10 | 在售商品数阈值，超过此数量将进行AI分析 |
| analysis_days | 30 | 分析用户最近N天的行为数据 |
| ai_confidence_threshold | 0.7 | AI判断为商贩的置信度阈值 |
| auto_set_pending | true | 识别出商贩后自动设为待认证状态 |
| detection_enabled | true | 启用商贩检测功能 |

## 使用方法

### 1. 管理员配置

在商家管理页面可以配置以下参数：

- **监控商品数量**：设置监控的商品数量范围
- **商品数阈值**：设置触发AI分析的商品数量阈值
- **分析天数**：设置分析用户行为的时间范围
- **AI置信度阈值**：设置AI判断的置信度要求
- **自动设为待认证**：是否自动处理识别结果
- **启用检测**：是否启用检测功能

### 2. 手动检测

管理员可以手动触发检测：

1. 在商家管理页面点击"手动检测"按钮
2. 系统将分析所有高活跃用户
3. 显示检测结果和统计信息

### 3. 自动检测

系统每天凌晨2点自动执行检测：

1. 扫描所有分类和首页商品
2. 识别高活跃用户
3. 进行AI分析
4. 自动处理识别结果

## AI分析指标

系统通过以下指标分析用户行为：

### 基础指标
- 总发布商品数
- 在售商品数
- 已售商品数
- 日均发布率

### 商品特征
- 商品分类分布
- 价格范围统计
- 商品标题关键词
- 商品描述内容

### 行为模式
- 发布频率
- 商品多样性
- 价格策略
- 商业性词汇使用

## 检测流程

1. **商品监控**
   - 获取各分类前N个商品
   - 获取首页前N个商品
   - 收集用户ID列表

2. **阈值筛选**
   - 统计用户在售商品数
   - 筛选超过阈值的用户

3. **行为分析**
   - 分析用户最近N天行为
   - 统计各项指标
   - 构建分析数据

4. **AI判断**
   - 调用星火大模型
   - 分析用户行为模式
   - 返回判断结果

5. **自动处理**
   - 根据置信度阈值决定
   - 自动设为待认证状态
   - 记录处理日志

## 技术特点

### 1. 智能识别
- 基于AI的智能判断
- 多维度行为分析
- 可配置的置信度阈值

### 2. 自动化管理
- 定时自动检测
- 自动处理识别结果
- 减少人工干预

### 3. 灵活配置
- 可调整的检测参数
- 实时配置更新
- 支持手动检测

### 4. 详细统计
- 检测结果统计
- 用户活跃度分析
- 系统运行状态

## 注意事项

1. **AI分析准确性**
   - 系统依赖AI模型的判断准确性
   - 建议定期检查识别结果
   - 可根据实际情况调整置信度阈值

2. **性能考虑**
   - 检测过程可能消耗较多资源
   - 建议在低峰期执行检测
   - 可根据服务器性能调整监控数量

3. **误判处理**
   - 系统可能存在误判情况
   - 管理员可手动解除待认证状态
   - 建议定期审核检测结果

## 扩展功能

### 1. 机器学习优化
- 收集用户反馈数据
- 优化AI判断模型
- 提高识别准确性

### 2. 更多检测指标
- 用户登录频率
- 商品浏览行为
- 交易记录分析

### 3. 预警系统
- 实时监控异常用户
- 发送预警通知
- 自动处理策略

## 维护建议

1. **定期检查**
   - 每周检查检测结果
   - 调整配置参数
   - 优化检测策略

2. **数据清理**
   - 定期清理检测日志
   - 维护配置数据
   - 备份重要数据

3. **性能监控**
   - 监控检测执行时间
   - 优化数据库查询
   - 调整任务调度频率
